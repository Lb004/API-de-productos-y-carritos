<div class="product-detail-container">
  {{#if product}}
    <div class="product-detail-card">
      <h1>{{product.title}}</h1>
      <span class="product-price">${{product.price}}</span>
      <p>{{product.description}}</p>
      
      <div class="product-meta">
        <p><strong>Categor√≠a:</strong> {{product.category}}</p>
        <p><strong>C√≥digo:</strong> {{product.code}}</p>
        <p><strong>Stock:</strong> <span class="{{#if product.stock}}in-stock{{else}}out-of-stock{{/if}}">
          {{#if product.stock}}{{product.stock}} unidades{{else}}Sin stock{{/if}}
        </span></p>
      </div>

      <div class="product-actions">
        {{#if product.stock}}
          <button class="btn btn-primary add-to-cart-btn" data-product-id="{{product._id}}">
            üõí Agregar al Carrito
          </button>
        {{else}}
          <button class="btn btn-disabled" disabled>Sin Stock</button>
        {{/if}}
        <a href="/" class="btn btn-secondary">‚Üê Volver</a>
      </div>
    </div>
  {{else}}
    <div class="error-message">
      <h2>Producto no encontrado</h2>
      <a href="/" class="btn btn-primary">Volver a la tienda</a>
    </div>
  {{/if}}
</div>

<style>
.product-detail-container { max-width: 800px; margin: 0 auto; padding: 20px; }
.product-detail-card { background: white; border-radius: 10px; padding: 30px; }
.product-price { font-size: 2rem; font-weight: bold; color: #667eea; }
.product-meta { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 25px 0; }
.in-stock { color: #28a745; font-weight: bold; }
.out-of-stock { color: #dc3545; font-weight: bold; }
.product-actions { display: flex; gap: 15px; margin-top: 25px; }
.btn { padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; text-decoration: none; }
.btn-primary { background: #667eea; color: white; }
.btn-secondary { background: #6c757d; color: white; }
.btn-disabled { background: #ccc; color: #666; cursor: not-allowed; }
</style>

<script>
document.querySelector('.add-to-cart-btn')?.addEventListener('click', async function() {
  const productId = this.dataset.productId;
  
  try {
    let cartId = localStorage.getItem('currentCartId');
    
    if (!cartId) {
      const response = await fetch('/api/carts', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      });
      const result = await response.json();
      cartId = result.payload._id;
      localStorage.setItem('currentCartId', cartId);
    }
    
    const addResponse = await fetch(`/api/carts/${cartId}/product/${productId}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' }
    });
    
    if (addResponse.ok) {
      alert('‚úÖ Producto agregado al carrito');
    } else {
      const error = await addResponse.json();
      alert('‚ùå Error: ' + error.message);
    }
  } catch (error) {
    alert('‚ùå Error: ' + error.message);
  }
});
</script>